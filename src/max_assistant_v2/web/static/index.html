<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FRANK Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    background: #0f111a;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
}

h1 {
    margin-top: 50px;
    letter-spacing: 4px;
}

#status {
    margin-top: 20px;
    opacity: 0.7;
}

#response {
    margin: 30px;
    font-size: 18px;
    min-height: 80px;
}

.mic-btn {
    margin: 40px auto;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: #1f6feb;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    cursor: pointer;
    transition: 0.3s;
}

.mic-btn.listening {
    animation: pulse 1s infinite;
    background: #ff4c4c;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}
</style>
</head>

<body>

<h1>FRANK</h1>
<div id="status">PrÃªt</div>
<div id="response"></div>
<div class="mic-btn" id="mic">ðŸŽ¤</div>

<script>
const TOKEN = "frank-local-token";
const micBtn = document.getElementById("mic");
const statusDiv = document.getElementById("status");
const responseDiv = document.getElementById("response");

let mediaRecorder;
let audioChunks = [];
let isRecording = false;

micBtn.onclick = async () => {

    if (!isRecording) {

        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = event => {
            audioChunks.push(event.data);
        };

        mediaRecorder.onstop = async () => {

            statusDiv.innerText = "Traitement...";
            micBtn.classList.remove("listening");
            isRecording = false;

            const blob = new Blob(audioChunks, { type: "audio/webm" });

            const formData = new FormData();
            formData.append("file", blob);
            formData.append("token", TOKEN);

            const response = await fetch("/voice", {
                method: "POST",
                body: formData
            });

            const data = await response.json();

            responseDiv.innerText = data.response || "";
            statusDiv.innerText = "Calme";

            const utter = new SpeechSynthesisUtterance(data.response);
            utter.lang = "fr-FR";
            speechSynthesis.speak(utter);
        };

        mediaRecorder.start();
        micBtn.classList.add("listening");
        statusDiv.innerText = "Ã‰coute...";
        isRecording = true;

    } else {

        mediaRecorder.stop();
    }
};
</script>




</body>
</html>
